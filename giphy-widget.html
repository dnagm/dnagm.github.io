<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giphy Widget</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        #search { width: 80%; padding: 10px; margin-bottom: 10px; }
        .gif { width: 100px; height: auto; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <h2>Buscar GIF</h2>
    <input type="text" id="search" placeholder="Escribe para buscar...">
    <button onclick="buscarGIF()">Buscar</button>
    <div id="results"></div>

    <script>
        const GIPHY_API_KEY = "zYVIJUiLGH8QKQ67Jv9rNBnhMTX7ohsG";  // Reemplázala con tu API Key de Giphy
        const MATRIX_HOMESERVER = "https://matrix.org";  // Cambia si usas otro servidor
        let matrixRoomId = "";  // Se configurará dinámicamente desde Element

        function buscarGIF() {
            let query = document.getElementById("search").value;
            let url = `https://api.giphy.com/v1/gifs/search?api_key=${GIPHY_API_KEY}&q=${query}&limit=10`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    let resultsDiv = document.getElementById("results");
                    resultsDiv.innerHTML = "";
                    data.data.forEach(gif => {
                        let img = document.createElement("img");
                        img.src = gif.images.fixed_height.url;
                        img.className = "gif";
                        img.onclick = () => enviarGIF(gif.images.original.url);
                        resultsDiv.appendChild(img);
                    });
                });
        }

        function enviarGIF(gifUrl) {
            let event = {
                "api": "fromWidget",
                "requestId": "sendGif",
                "action": "m.send.event",
                "data": {
                    "type": "m.room.message",
                    "content": {
                        "msgtype": "m.image",
                        "body": "GIF",
                        "url": gifUrl
                    }
                }
            };
            parent.postMessage(event, "*");
        }

        window.addEventListener("message", (event) => {
            if (event.data?.api === "toWidget" && event.data?.action === "capabilities") {
                matrixRoomId = event.data.data?.room_id;
            }
        });

        parent.postMessage({ api: "fromWidget", action: "ready" }, "*");
    </script>

</body>
</html>
