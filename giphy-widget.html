// Modificar la función updateTextFormat para usar formatos optimizados para Matrix
function updateTextFormat() {
    if (!currentGif) return;
    
    const gifUrl = currentGif.images.original.url;
    // También podemos probar con versiones más ligeras 
    // const gifUrl = currentGif.images.fixed_height.url;
    
    switch (currentFormat) {
        case 'url':
            markdownBox.textContent = gifUrl;
            break;
        case 'html':
            // Formato HTML con width 100% para mejor compatibilidad
            markdownBox.textContent = `<img src="${gifUrl}" alt="" style="max-width: 100%;" />`;
            break;
        case 'md':
            // Markdown sin texto alternativo (mejor compatibilidad con Matrix)
            markdownBox.textContent = `![](${gifUrl})`;
            break;
        case 'command':
            // Comando /html con estilo inline para asegurar renderizado correcto
            markdownBox.textContent = `/html <img src="${gifUrl}" alt="" style="max-width: 100%;">`;
            break;
        case 'riot':
            // Mensaje de acción simple
            markdownBox.textContent = `/me envía ${gifUrl}`;
            break;
        case 'mxreply': // Nuevo formato
            // Formato mx-reply para mejor integración
            markdownBox.textContent = `<mx-reply><blockquote><img src="${gifUrl}" alt=""></blockquote></mx-reply>`;
            break;
    }
}

// Añadir un nuevo botón para el formato mx-reply
// En tu HTML: <button id="format-mxreply" class="format-button">mx-reply</button>

// Y el evento correspondiente:
formatMxReplyBtn.addEventListener('click', function() {
    currentFormat = 'mxreply';
    updateActiveFormatButton(this);
    updateTextFormat();
});

// Actualiza la función para incluir el nuevo botón
function updateActiveFormatButton(activeButton) {
    formatUrlBtn.classList.remove('active');
    formatHtmlBtn.classList.remove('active');
    formatMdBtn.classList.remove('active');
    formatCommandBtn.classList.remove('active');
    formatRiotBtn.classList.remove('active');
    formatMxReplyBtn.classList.remove('active'); // Añadir esta línea
    
    activeButton.classList.add('active');
}
